# -*- coding: utf-8 -*-
"""Imers√£o IA Alura + Google Gemini - Agente de analise de dados

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1DcPGAZC_kFCIaCUsfp1V--aCTYPfMWHZ
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip install -U -q google-genai
# %pip install -U -q google-adk

# Configura a API Key do Google Gemini

import os
from google.colab import userdata

os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

# Configura o cliente da SDK do Gemini

from google import genai
from google.genai import types # Necess√°rio para tipos como Content e Part

client = genai.Client()

MODEL_ID = "gemini-2.0-flash"

# Exemplo B√°sico de Chamada ao Gemini (Sem Ferramentas)
from IPython.display import HTML, Markdown # Para exibir texto formatado

# Perguntar pro modelo quando √© a pr√≥xima imers√£o de IA ###############################################

# Faz uma chamada simples ao modelo
response = client.models.generate_content(
    model=MODEL_ID, # Usando o MODEL_ID definido anteriormente
    contents='Qual √© a data da pr√≥xima Imers√£o IA com Google Gemini da Alura?' # Sua pergunta aqui
)

# Armazena a resposta do modelo na vari√°vel 'resposta'.
# response.candidates[0].content √© o objeto Content
resposta_content = response.candidates[0].content

# Para acessar o texto, precisamos iterar sobre as "partes" (parts) do objeto Content
full_response_text = "" # Cria uma string vazia para armazenar o texto completo
# Verifica se o objeto content_response tem o atributo 'parts' e se ele n√£o est√° vazio
if hasattr(resposta_content, 'parts') and resposta_content.parts:
    for part in resposta_content.parts: # Itera sobre cada parte na lista de partes do Content
        if hasattr(part, 'text') and part.text: # Verifica se a parte atual cont√©m texto
            full_response_text += part.text # Adiciona o texto da parte atual √† string completa

# Agora usamos a string 'full_response_text' que cont√©m o texto completo da resposta
display(Markdown(f"Resposta:\n {full_response_text}"))

# Configura√ß√£o da Ferramenta de Busca (Usando a Ferramenta do ADK)

# Importa a ferramenta de busca Google fornecida pelo ADK
# Esta ferramenta j√° est√° configurada para ser usada com agentes do ADK.
from google.adk.tools import google_search

try:


    print("Ferramenta 'google_search' do ADK importada com sucesso.")

except Exception as e:
    print(f"Ocorreu um erro ao tentar usar a ferramenta do ADK: {e}")

# A execu√ß√£o real da busca usando a ferramenta google_search do ADK ocorrer√°
# quando um Agente do ADK (definido nas c√©lulas futuras) decidir usar esta ferramenta
# durante a execu√ß√£o gerenciada pelo Runner do ADK.

# Exibir Metadados de Busca (Pode n√£o funcionar neste fluxo ADK)


# Verifica se a vari√°vel 'response' da c√©lula anterior existe e tem candidatos/metadados
if 'response' in locals() and response.candidates and response.candidates[0].grounding_metadata:
    grounding_metadata = response.candidates[0].grounding_metadata

    print("Tentando exibir metadados de busca:")

    if hasattr(grounding_metadata, 'web_search_queries') and grounding_metadata.web_search_queries:
        print(f"Busca realizada: {grounding_metadata.web_search_queries}")
    else:
        print("O modelo n√£o forneceu a query de busca web utilizada.")

    if hasattr(grounding_metadata, 'grounding_chunks') and grounding_metadata.grounding_chunks:
        web_chunks = [chunk for chunk in grounding_metadata.grounding_chunks if hasattr(chunk, 'web') and chunk.web]
        if web_chunks:
            page_titles = [chunk.web.title for chunk in web_chunks if hasattr(chunk.web, 'title')]
            if page_titles:
                print(f"P√°ginas utilizadas na resposta: {', '.join(page_titles)}")
            else:
                print("O modelo utilizou p√°ginas web, mas os t√≠tulos n√£o est√£o dispon√≠veis.")
        else:
            print("O modelo utilizou informa√ß√µes de busca, mas detalhes das p√°ginas web n√£o est√£o dispon√≠veis.")
    else:
        print("O modelo n√£o forneceu metadados detalhados sobre as fontes utilizadas.")

    if hasattr(grounding_metadata, 'search_entry_point') and hasattr(grounding_metadata.search_entry_point, 'rendered_content'):
        from IPython.display import display, HTML
        display(HTML(grounding_metadata.search_entry_point.rendered_content))
    else:
        print("Informa√ß√µes visuais sobre o ponto de entrada da busca n√£o est√£o dispon√≠veis.")

else:
    # Mensagem caso o modelo n√£o tenha utilizado a busca ou n√£o tenha fornecido metadados NESTA C√âLULA.
    print("Metadados de busca n√£o dispon√≠veis na resposta da C√©lula 5 (esperado no fluxo ADK).")

print() # Adiciona uma linha em branco

# Importa√ß√µes e Fun√ß√µes Auxiliares do ADK
# Importa classes e ferramentas do Agent Development Kit (ADK)
from google.adk.agents import Agent # Classe base para definir agentes
from google.adk.runners import Runner # Para executar os agentes
from google.adk.sessions import InMemorySessionService # Servi√ßo de sess√£o em mem√≥ria
from google.adk.tools import google_search # Ferramenta de busca Google do ADK

# Importa outros m√≥dulos necess√°rios
from google.genai import types # Para criar conte√∫dos (Content e Part)
from datetime import date # Para trabalhar com datas
import textwrap # Para formatar melhor a sa√≠da de texto
from IPython.display import display, Markdown # Para exibir texto formatado no Colab
import requests # Para fazer requisi√ß√µes HTTP (pode ser usado em alguma ferramenta customizada)
import warnings # Para gerenciar avisos

# Ignora avisos (pode ser √∫til durante o desenvolvimento)
warnings.filterwarnings("ignore")

# Fun√ß√£o auxiliar que envia uma mensagem para um agente via Runner e retorna a resposta final
# Esta fun√ß√£o encapsula a l√≥gica de rodar um agente do ADK.
def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um servi√ßo de sess√£o em mem√≥ria
    session_service = InMemorySessionService()

    # Cria uma nova sess√£o (voc√™ pode personalizar os IDs conforme necess√°rio)
    session = session_service.create_session(app_name=agent.name,
                                             user_id="user1", session_id="session1")

    # Cria um Runner para o agente
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)

    # Cria o conte√∫do da mensagem de entrada para o agente
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = "" # Vari√°vel para acumular a resposta final

    # Itera assincronamente pelos eventos retornados durante a execu√ß√£o do agente
    # Nota: Em um ambiente s√≠ncrono como um notebook, a execu√ß√£o parecer√° s√≠ncrona.
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        # Verifica se o evento √© a resposta final do agente
        if event.is_final_response():
            # Se for a resposta final, itera sobre as partes do conte√∫do
            if hasattr(event, 'content') and hasattr(event.content, 'parts'):
                 for part in event.content.parts:
                      if hasattr(part, 'text') and part.text is not None:
                           final_response += part.text
                      # Adiciona uma quebra de linha se n√£o for a √∫ltima parte e tiver texto
                      # if hasattr(part, 'text') and part.text is not None and part != event.content.parts[-1]:
                      #    final_response += "\n"
            # Adiciona uma quebra de linha no final da resposta do agente
            final_response += "\n"


    return final_response.strip() # Retorna a resposta final (removendo espa√ßos em branco extras no in√≠cio/fim)

# Fun√ß√£o auxiliar para exibir texto formatado em Markdown no Colab
# Esta fun√ß√£o usa textwrap para identar o texto e Markdown para formatar.
def to_markdown(text):
    # Substitui '*' por '.' (parece ser uma formata√ß√£o espec√≠fica do c√≥digo base)
    # text = text.replace('*', '.') # <--- Removido, pois parece ser um erro de c√≥pia/colagem

    # Identifica o texto com '>' para simular uma cita√ß√£o ou resposta do agente
    indented_text = textwrap.indent(text, '> ', predicate=lambda line: True) # Indenta cada linha

    # Retorna o texto formatado como Markdown
    return Markdown(indented_text)

# Buscador de Informa√ß√µes/Dados Relevantes

# Define o Agente Buscador usando a classe Agent do ADK
buscador_dados = Agent(
    name="agente_buscador_dados", # Nome √∫nico para o agente
    model=MODEL_ID, # Usa o modelo Gemini definido na C√©lula 3
    # Instru√ß√µes para o Agente Buscador de Dados
    instruction="""
    Voc√™ √© um Agente Buscador de Dados especializado em identificar quais tipos de dados e informa√ß√µes
    s√£o relevantes para investigar um problema de neg√≥cio espec√≠fico.
    Sua tarefa √© analisar a descri√ß√£o do problema fornecida pelo usu√°rio e listar os tipos de dados,
    m√©tricas ou informa√ß√µes que seriam √∫teis para come√ßar a an√°lise.
    Pense em dados de vendas, marketing, clientes, opera√ß√µes, mercado, etc., relevantes para o contexto.
    Se necess√°rio, use a ferramenta de busca para encontrar exemplos gerais de dados relacionados ao t√≥pico.
    Sua resposta deve ser uma lista clara dos tipos de dados/informa√ß√µes relevantes.
    """,
    description="Agente que identifica dados e informa√ß√µes relevantes para problemas de neg√≥cio.",
    tools=[google_search] # Associa a ferramenta de busca Google do ADK a este agente
)

# Nota: A execu√ß√£o deste agente acontecer√° mais tarde no fluxo principal,
# quando voc√™ chamar call_agent(buscador_dados, ...)

# Agente 2 - Planejador de An√°lise

# Define a fun√ß√£o que executa o Agente Planejador de An√°lise
# Ele recebe o problema original e a lista de dados relevantes do Agente Buscador.
def agente_planejador_analise(problema_negocio: str, dados_relevantes: str) -> str:
    # Define o Agente Planejador de An√°lise usando a classe Agent do ADK
    planejador_analise = Agent(
        name="agente_planejador_analise", # Nome √∫nico para o agente
        model=MODEL_ID, # Usa o modelo Gemini definido na C√©lula 3
        # Instru√ß√µes para o Agente Planejador de An√°lise
        instruction=f"""
        Voc√™ √© um Agente Planejador de An√°lise de Dados.
        Voc√™ recebeu um problema de neg√≥cio e uma lista de tipos de dados relevantes.
        Sua tarefa √© criar um plano passo a passo para analisar esses dados e investigar o problema.
        O plano deve ser l√≥gico, claro e focado em como usar os dados para encontrar a causa ou solu√ß√£o do problema.
        Liste as etapas de an√°lise de forma numerada ou com marcadores.
        Problema de Neg√≥cio: {problema_negocio}
        Dados Relevantes Identificados: {dados_relevantes}
        """,
        description="Agente que cria planos de an√°lise de dados para problemas de neg√≥cio.",
        tools=[] # Este agente talvez n√£o precise de ferramentas externas, foca no racioc√≠nio l√≥gico
        # Se o plano precisar de exemplos de t√©cnicas de an√°lise, poderia associar a google_search
        # tools=[google_search] # Opcional: se precisar buscar exemplos de t√©cnicas
    )

    # Prepara a entrada para o Agente Planejador
    entrada_planejador = f"Problema: {problema_negocio}\nDados Relevantes: {dados_relevantes}"

    # Executa o agente usando a fun√ß√£o auxiliar call_agent da C√©lula 8
    plano_analise = call_agent(planejador_analise, entrada_planejador)

    return plano_analise # Retorna o plano de an√°lise gerado

# Agente 3 - Gerador de C√≥digo/Insights

# Define a fun√ß√£o que executa o Agente Gerador de C√≥digo/Insights
# Ele recebe uma etapa espec√≠fica do plano e (opcionalmente) dados/resultados.
def agente_gerador_codigo_insights(etapa_plano: str, dados_ou_resultados: str = "") -> str:
    # Define o Agente Gerador usando a classe Agent do ADK
    gerador_analise = Agent(
        name="agente_gerador_analise",
        model=MODEL_ID,
        # Instru√ß√µes para o Agente Gerador de C√≥digo/Insights
        instruction=f"""
        Voc√™ √© um Agente Gerador de C√≥digo e Insights para An√°lise de Dados.
        Sua tarefa √© ajudar a executar uma etapa espec√≠fica de um plano de an√°lise.
        Com base na descri√ß√£o da etapa e nos dados/resultados fornecidos (se houver),
        voc√™ deve:
        1. Se a etapa for sobre processamento ou visualiza√ß√£o, **gerar um snippet de c√≥digo** (preferencialmente Python com Pandas/Matplotlib ou SQL) relevante para a tarefa. O c√≥digo deve ser claro e com coment√°rios.
        2. Se a etapa for sobre interpreta√ß√£o, **oferecer insights** sobre os resultados fornecidos.
        3. Se precisar de exemplos de c√≥digo ou explica√ß√µes, use a ferramenta de busca.
        Sua resposta deve conter o c√≥digo formatado em um bloco de c√≥digo ou a interpreta√ß√£o clara.

        Etapa do Plano: {etapa_plano}
        Dados ou Resultados Fornecidos: {dados_ou_resultados}
        """,
        description="Agente que gera c√≥digo ou insights para etapas de an√°lise de dados.",
        tools=[google_search] # Associa a ferramenta de busca Google do ADK a este agente (√∫til para buscar exemplos de c√≥digo)
    )

    # Prepara a entrada para o Agente Gerador
    entrada_gerador = f"Etapa do Plano: {etapa_plano}\nDados/Resultados: {dados_ou_resultados}"

    codigo_ou_insight = call_agent(gerador_analise, entrada_gerador)

    return codigo_ou_insight # Retorna o c√≥digo gerado ou o insight

# Agente 4 - Revisor e Formatador de Resposta Final

# Define a fun√ß√£o que executa o Agente Revisor e Formatador
# Ele recebe o resultado do Agente Gerador (c√≥digo ou insight).
def agente_revisor_formatador(resultado_gerador: str) -> str:
    # Define o Agente Revisor/Formatador usando a classe Agent do ADK
    revisor_formatador = Agent(
        name="agente_revisor_formatador",
        model=MODEL_ID,
        instruction=f"""
        Voc√™ √© um Agente Revisor e Formatador de Respostas para An√°lise de Dados.
        Sua tarefa √© pegar o resultado de uma an√°lise (c√≥digo, insight, explica√ß√£o)
        e format√°-lo de forma clara, profissional e f√°cil de entender para um p√∫blico de neg√≥cios ou t√©cnico.
        Se for c√≥digo, garanta que esteja em um bloco de c√≥digo Markdown.
        Se for um insight, explique-o de forma concisa.
        Adicione um toque amig√°vel e √∫til √† resposta final.
        Resultado a ser revisado e formatado: {resultado_gerador}
        """,
        description="Agente que revisa e formata resultados de an√°lise de dados.",
        tools=[] # Este agente foca na formata√ß√£o, provavelmente n√£o precisa de ferramentas externas
    )

    # Prepara a entrada para o Agente Revisor
    entrada_revisor = resultado_gerador

    resposta_final_formatada = call_agent(revisor_formatador, entrada_revisor)

    return resposta_final_formatada # Retorna a resposta final formatada

# Agente 3 - Gerador de C√≥digo/Insights

# Define a fun√ß√£o que executa o Agente Gerador de C√≥digo/Insights
# Ele recebe uma etapa espec√≠fica do plano e (opcionalmente) dados/resultados.
def agente_gerador_codigo_insights(etapa_plano: str, dados_ou_resultados: str = "") -> str:
    # Define o Agente Gerador usando a classe Agent do ADK
    gerador_analise = Agent(
        name="agente_gerador_analise", # Nome √∫nico para o agente
        model=MODEL_ID, # Usa o modelo Gemini definido na C√©lula 3
        # Instru√ß√µes para o Agente Gerador de C√≥digo/Insights
        instruction=f"""
        Voc√™ √© um Agente Gerador de C√≥digo e Insights para An√°lise de Dados.
        Sua tarefa √© ajudar a executar uma etapa espec√≠fica de um plano de an√°lise.
        Com base na descri√ß√£o da etapa e nos dados/resultados fornecidos (se houver),
        voc√™ deve:
        1. Se a etapa for sobre processamento ou visualiza√ß√£o, **gerar um snippet de c√≥digo** (preferencialmente Python com Pandas/Matplotlib ou SQL) relevante para a tarefa. O c√≥digo deve ser claro e com coment√°rios.
        2. Se a etapa for sobre interpreta√ß√£o, **oferecer insights** sobre os resultados fornecidos.
        3. Se precisar de exemplos de c√≥digo ou explica√ß√µes, use a ferramenta de busca.
        Sua resposta deve conter o c√≥digo formatado em um bloco de c√≥digo ou a interpreta√ß√£o clara.

        Etapa do Plano: {etapa_plano}
        Dados ou Resultados Fornecidos: {dados_ou_resultados}
        """,
        description="Agente que gera c√≥digo ou insights para etapas de an√°lise de dados.",
        tools=[google_search] # Associa a ferramenta de busca Google do ADK a este agente (√∫til para buscar exemplos de c√≥digo)
    )

    # Prepara a entrada para o Agente Gerador
    entrada_gerador = f"Etapa do Plano: {etapa_plano}\nDados/Resultados: {dados_ou_resultados}"

    # Executa o agente usando a fun√ß√£o auxiliar call_agent da C√©lula 8
    codigo_ou_insight = call_agent(gerador_analise, entrada_gerador)

    return codigo_ou_insight # Retorna o c√≥digo gerado ou o insight

"""python"""

# C√ìDIGO DE AN√ÅLISE DE DADOS
# Este c√≥digo demonstra como realizar an√°lises b√°sicas em um DataFrame Pandas.

# Importa a biblioteca pandas, que √© essencial para trabalhar com DataFrames.
import pandas as pd

# --- Carregar seus dados ---
# Voc√™ precisa carregar seus dados de vendas em um DataFrame Pandas chamado 'df_vendas'.
# Substitua 'seu_arquivo_de_vendas.csv' pelo caminho real do seu arquivo de dados.
# Se seus dados estiverem em outro formato (Excel, banco de dados, etc.), use a fun√ß√£o de leitura apropriada do pandas (ex: pd.read_excel(), pd.read_sql()).
try:
    # Exemplo: Carregando dados de um arquivo CSV
    df_vendas = pd.read_csv('seu_arquivo_de_vendas.csv')

    # Opcional: Exibir as primeiras linhas do DataFrame para verificar se carregou corretamente
    print("Primeiras linhas do DataFrame df_vendas:")
    display(df_vendas.head()) # Use display se estiver no Colab/Jupyter

    # --- An√°lises de Dados ---
    # Agora que df_vendas est√° definido, podemos realizar as an√°lises.

    # Analisar vendas totais por regi√£o
    # Agrupa os dados por 'regiao' e soma os valores de 'valor_venda', ordenando do maior para o menor.
    vendas_por_regiao = df_vendas.groupby('regiao')['valor_venda'].sum().sort_values(ascending=False)

    # Exibe o resultado da an√°lise de vendas por regi√£o.
    print("\nVendas por Regi√£o:")
    display(vendas_por_regiao) # Use display se estiver no Colab/Jupyter

    # Analisar tend√™ncia de vendas ao longo do tempo
    # Converte a coluna 'data' para o formato datetime e extrai o per√≠odo mensal.
    # Assume que existe uma coluna chamada 'data' no seu DataFrame.
    df_vendas['mes'] = pd.to_datetime(df_vendas['data']).dt.to_period('M')

    # Agrupa os dados por 'mes' e soma os valores de 'valor_venda'.
    vendas_por_mes = df_vendas.groupby('mes')['valor_venda'].sum()
    # Para plotar a tend√™ncia, voc√™ pode usar: vendas_por_mes.plot() # Exemplo de visualiza√ß√£o (requer matplotlib)

    # Exibe o resultado da an√°lise de vendas por m√™s.
    print("\nVendas Totais por M√™s:")
    display(vendas_por_mes) # Use display se estiver no Colab/Jupyter

except FileNotFoundError:
    print("\nErro: Arquivo 'seu_arquivo_de_vendas.csv' n√£o encontrado.")
    print("Por favor, substitua pelo caminho correto do seu arquivo de dados ou carregue os dados de outra forma.")
except KeyError as e:
    print(f"\nErro: Coluna {e} n√£o encontrada no DataFrame.")
    print("Verifique se as colunas 'regiao', 'valor_venda' e 'data' existem no seu arquivo de dados e est√£o escritas corretamente.")
except Exception as e:
    print(f"\nOcorreu um erro ao processar os dados: {e}")


# Nota: Este √© apenas um exemplo de c√≥digo de an√°lise.
# Seus agentes (especialmente o Agente Gerador) poderiam ajudar a criar ou explicar c√≥digos como este.
# Para usar este c√≥digo, certifique-se de ter a biblioteca pandas instalada:
# !pip install pandas
# E, se quiser plotar, instale matplotlib:
# !pip install matplotlib

# Fluxo Principal do Sistema de Agentes de An√°lise de Dados

from datetime import date # Importa date para obter a data atual

# Opcional: Exibir a data atual (mantido do c√≥digo original)
data_de_hoje = date.today().strftime("%d/%m/%Y")
print(f"Data de hoje: {data_de_hoje}")

print("üìä Iniciando o Sistema de Agentes para An√°lise de Dados em Empresas üìà")
print("Ol√°! Sou seu assistente de IA para ajudar com an√°lises de dados.")

# --- Obter o Problema de Neg√≥cio do Usu√°rio ---
problema_negocio = input("\n‚ùì Por favor, descreva o PROBLEMA DE NEG√ìCIO ou a pergunta que voc√™ quer investigar com dados: ")

print("\nüß† Analisando seu problema e buscando dados relevantes...")

# --- Etapa 1: Chamar o Agente Buscador de Dados ---
# O Agente Buscador identifica quais tipos de dados s√£o relevantes para o problema.
dados_relevantes = call_agent(buscador_dados, problema_negocio)

print("\n‚úÖ Tipos de dados relevantes identificados:")
display(to_markdown(dados_relevantes)) # Exibe a lista de dados relevantes formatada

print("\nüó∫Ô∏è Gerando um plano de an√°lise com base nos dados identificados...")

# --- Etapa 2: Chamar o Agente Planejador de An√°lise ---
# O Agente Planejador cria um plano passo a passo.
plano_analise = agente_planejador_analise(problema_negocio, dados_relevantes)

print("\n‚úÖ Plano de An√°lise Sugerido:")
display(to_markdown(plano_analise)) # Exibe o plano de an√°lise formatado

# --- Etapa 3: Loop de Intera√ß√£o com o Usu√°rio ---
# Permite que o usu√°rio escolha uma etapa do plano para detalhar,
# forne√ßa dados/resultados, ou saia.
while True:
    print("\n--- Pr√≥ximo Passo ---")
    acao_usuario = input(
        "O que voc√™ quer fazer? (Digite o n√∫mero da etapa do plano para detalhar, 'dados' para fornecer resultados, ou 'sair' para terminar): "
    ).lower().strip()

    if acao_usuario == 'sair':
        print("\nüëã Obrigado por usar o assistente de an√°lise de dados! At√© a pr√≥xima!")
        break # Sai do loop

    elif acao_usuario.isdigit():
        # O usu√°rio digitou um n√∫mero, assume que √© o n√∫mero da etapa do plano.
        # Nota: Este √© um exemplo simplificado. Em um sistema real, voc√™ precisaria
        # parsear o plano_analise para identificar as etapas corretamente.
        # Aqui, apenas usamos o n√∫mero como refer√™ncia para o Agente Gerador.
        numero_etapa = int(acao_usuario)
        etapa_escolhida_descricao = f"Etapa {numero_etapa} do plano: {plano_analise.splitlines()[numero_etapa-1] if numero_etapa <= len(plano_analise.splitlines()) else 'Etapa n√£o encontrada'}" # Tenta pegar a descri√ß√£o da etapa

        print(f"\n‚úçÔ∏è Detalhando a Etapa {numero_etapa}...")

        # --- Etapa 4: Chamar o Agente Gerador de C√≥digo/Insights ---
        # Pede ao usu√°rio para fornecer dados/resultados para esta etapa (opcional).
        dados_resultados_etapa = input(f"Tem dados ou resultados espec√≠ficos para a Etapa {numero_etapa}? (Cole aqui ou deixe em branco): ").strip()

        resultado_gerador = agente_gerador_codigo_insights(etapa_escolhida_descricao, dados_resultados_etapa)

        print("\n‚ú® Revisando e formatando a resposta...")

        # --- Etapa 5: Chamar o Agente Revisor e Formatador ---
        resposta_final = agente_revisor_formatador(resultado_gerador)

        print("\n‚úÖ Resposta Final:")
        display(to_markdown(resposta_final)) # Exibe a resposta final formatada

    elif acao_usuario == 'dados':
        # O usu√°rio quer fornecer dados ou resultados gerais.
        dados_gerais = input("\nPor favor, cole os dados ou resultados que voc√™ quer que eu interprete: ").strip()
        if dados_gerais:
            print("\nüß† Interpretando os dados/resultados fornecidos...")
            # Podemos chamar diretamente o Agente Gerador ou Revisor com os dados gerais
            # para obter uma interpreta√ß√£o ou resumo. Vamos chamar o Gerador para insights.
            resultado_gerador_dados = agente_gerador_codigo_insights("Interprete os dados/resultados fornecidos.", dados_gerais)

            print("\n‚ú® Revisando e formatando a interpreta√ß√£o...")
            resposta_final_dados = agente_revisor_formatador(resultado_gerador_dados)

            print("\n‚úÖ Interpreta√ß√£o:")
            display(to_markdown(resposta_final_dados))
        else:
            print("Nenhum dado fornecido.")

    else:
        print("\nComando inv√°lido. Por favor, digite o n√∫mero da etapa, 'dados', ou 'sair'.")